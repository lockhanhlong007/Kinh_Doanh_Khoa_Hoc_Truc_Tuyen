var LessonJquery=function(){function t(){$("#comment-form").submit(function(n){n.preventDefault();var t=$(this),i=$("#hid_current_login_id").val(),r=t.attr("action");$.post(r,t.serialize()).done(function(n){var u=$("#tmpl_comments").html(),f=Mustache.render(u,{content:n.content,creationTime:moment(n.creationTime).fromNow(),ownerUser:n.ownerUser,checkUserComment:i===n.userId?!0:!1});$("#reviewer-text").val("");$("#comment_list").prepend(f);var e=parseInt($("#hid_number_of_comments").val()),t=e+1,r=t+" Bình Luận";$("#number-comments-non-login").text(r);$("#number-comments").text(r);$("#span-count-comments").text("("+t+")");$("#hid_number_of_comments").val(t)})});$("body").on("click",".comment-reply-link",function(n){if(n.preventDefault(),$("#hid_current_login_id").val()==="")window.location.href="/login.html";else{var t=$(this).data("commentid"),i=$("#tmpl_reply_comment").html(),r=$("#hid_current_login_id").val(),u=Mustache.render(i,{commentId:t});$("#reply_comment_"+t).append(u);$("#frm_reply_comment_"+t).submit(function(n){n.preventDefault();var i=$(this),u=i.attr("action");$.post(u,i.serialize()).done(function(n){var f=$("#tmpl_children_comments").html(),e=Mustache.render(f,{id:n.id,content:n.content,creationTime:moment(n.creationTime).fromNow(),ownerUser:n.ownerUser,checkUserComment:r===n.userId?!0:!1});$("#txt_reply_content_"+t).val("");$("#reply_comment_"+t).html("");$("#children_comments_"+t).prepend(e);var o=parseInt($("#hid_number_of_comments").val()),i=o+1,u=i+" Bình Luận";$("#number-comments-non-login").text(u);$("#number-comments").text(u);$("#span-count-comments").text("("+i+")");$("#hid_number_of_comments").val(i)})})}});$("body").on("click",".comment-delete-link",function(n){n.preventDefault();var t=$(this).data("commentid"),i=$(this).closest(".commentCheck"),r=parseInt($("#hid_lesson_id").val());client_app.confirm("Bạn có chắc muốn xóa bình luận này?",function(){$.ajax({type:"POST",url:"/Courses/DeleteComment",data:{id:t},dataType:"json",beforeSend:function(){client_app.startLoading()},success:function(){$.ajax({type:"GET",url:"/Courses/GetCommentById",dataType:"json",data:{id:r,pageIndex:1,entityType:"lessons"},success:function(n){var t=n.totalRecords,r=t+" Bình Luận";$("#number-comments-non-login").text(r);$("#number-comments").text(r);$("#span-count-comments").text("("+t+")");$("#hid_number_of_comments").val(t);i.remove()}});client_app.notify("Xóa Thành Công","success");client_app.stopLoading()},error:function(){console.log("Có lỗi xảy ra");client_app.notify("Xóa Thành Công","success");client_app.stopLoading()}})})});$("body").on("click","#comment-pagination",function(t){t.preventDefault();var r=parseInt($("#hid_lesson_id").val()),i=parseInt($(this).data("page-index"))+1;$(this).data("page-index",i);n(r,i)});$("body").on("click",".replied-comment-pagination",function(n){n.preventDefault();var r=parseInt($("#hid_lesson_id").val()),u=parseInt($(this).data("id")),t=parseInt($(this).data("page-index"))+1;$(this).data("page-index",t);i(r,u,t)})}function n(n,t){t===undefined&&(t=1);$.ajax({type:"GET",url:"/Courses/GetCommentById",dataType:"json",data:{id:n,pageIndex:t,entityType:"lessons"},success:function(n){var f=$("#tmpl_comments").html(),e=$("#tmpl_children_comments").html(),i,r,t,u;n&&n.items&&(i="",r=$("#hid_current_login_id").val(),$.each(n.items,function(n,t){var u="";t.children&&t.children.items&&$.each(t.children.items,function(n,t){u+=Mustache.render(e,{content:t.content,creationTime:moment(t.creationTime).fromNow(),ownerUser:t.ownerUser,id:t.id,checkUserComment:r===t.userId?!0:!1})});u+=t.children.pageIndex<t.children.pageCount?'<div class="dash__link dash__link--brand u-s-m-y-15"><a href="#" class="replied-comment-pagination" id="replied-comment-pagination-'+t.id+'" data-page-index="1" data-id="'+t.id+'">Xem thêm bình luận<\/a><\/div>':'<div class="dash__link dash__link--brand u-s-m-y-15"><a href="#" class="replied-comment-pagination" id="replied-comment-pagination-'+t.id+'" data-page-index="1" data-id="'+t.id+'" style="display:none">Xem thêm bình luận<\/a><\/div>';i+=Mustache.render(f,{childrenHtml:u,content:t.content,creationTime:moment(t.creationTime).fromNow(),ownerUser:t.ownerUser,id:t.id,checkUserComment:r===t.userId?!0:!1})}),t=n.totalRecords,u=t+" Bình Luận",$("#number-comments-non-login").text(u),$("#number-comments").text(u),$("#span-count-comments").text("("+t+")"),$("#hid_number_of_comments").val(t),$("#comment_list").append(i),n.pageIndex<n.pageCount?$("#comment-pagination").show():$("#comment-pagination").hide())}})}function i(n,t,i){i===undefined&&(i=1);$.ajax({type:"GET",url:"/Courses/GetRepliedCommentById",dataType:"json",data:{id:n,pageIndex:i,entityType:"lessons",rootCommentId:t},success:function(n){var r=$("#hid_current_login_id").val(),u=$("#tmpl_children_comments").html(),i;n&&n.items&&(i="",$.each(n.items,function(t,f){i+=Mustache.render(u,{content:f.content,creationTime:moment(f.creationTime).fromNow(),ownerUser:f.ownerUser,id:f.id,checkUserComment:r===n.userId?!0:!1})}),$("#children_comments_"+t).prepend(i),n.pageIndex<n.pageCount?$("#replied-comment-pagination-"+t).show():$("#replied-comment-pagination-"+t).hide())}})}this.initialize=function(){var i=parseInt($("#hid_lesson_id").val());n(i);t()}};